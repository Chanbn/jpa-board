<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<script src="https://code.jquery.com/jquery.min.js"></script> 
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<div th:replace="/fragments/header.html :: fragment-header"></div>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
  <div th:replace="/fragments/nav.html :: fragment-nav"></div>
<div class="col-lg-6" style="text-align:center">
<form role="form" th:object=${vo} th:action="@{/board/modify}" method="post">
<input type="hidden" th:field="*{idx}" id="idx" name="idx">
<table class="table">
  <thead>
    <tr>
      <th colspan="3" scope="col">
      <label for="title" style="font-weight:bolder;">제목</label>
      <input type="text" th:field="*{title}" id="title" name="title" required="required">
      <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}">
      </th>
    </tr>
  </thead>
  <tbody>
  <tr>
  <td colspan="3">
  <div style="text-align:right">
  <span>작성자</span>&nbsp; <input type="text" th:field="*{writer}" id="writer" name="writer" placeholder="작성자를 입력하세요." required="required" readonly>&nbsp;&nbsp; <span>등록시간</span>
  </div>
  </td>
  </tr>

    <tr height="200">
    
      <td>      
            <label for="content" style="font-weight:bolder;">내용</label>  
      <textarea th:field="*{content}" id="content" name="content" rows="15" cols="50" placeholder="내용을 입력하세요." required="required"></textarea></td>
    </tr>
  </tbody>
</table>

<div th:if="${#lists.isEmpty(fileList)}" data-name="fileDiv">
<label for="file_0" class="col-sm-2 control-label">파일1</label>
	<div class="col-sm-10">
	<input type="text"  class="upload-name" value="파일찾기" readonly/>
	<label for="file_0" class="control-label">찾아보기</label>
	<input type="file" name="files" id="file_0"  style="display:none;" onchange="changeFilename(this)"> 
	<button type="button" onclick="addFile()">+
	<i class="fa fa-plus" aria-hidden="true" ></i>
	</button>	
	<button type="button" onclick="removeFile(this)">-
	<i class="fa fa-minus" aria-hidden="true"></i>
	</button>
	</div>
</div>

<div th:unless="${#lists.isEmpty(fileList)}" th:each="row, status : ${fileList}" data-name="fileDiv">
<label th:for="|file_${status.index}|" class="col-sm-2 control-label">[[|파일${status.count}|]]</label>
	<div class="col-sm-10">
	<input type="hidden" name="fileIdxs" th:value="${row.idx}">
	<input type="text"  class="upload-name" th:value="${row.originalName}" readonly/>
	<label th:for="|file_${status.index}|" class="control-label">찾아보기</label>
	<input type="file" name="files" th:id="|file_${status.index}|"  style="display:none;" onchange="changeFilename(this)"> 
	<button th:if="${status.first}" type="button" onclick="addFile()">+
	<i class="fa fa-plus" aria-hidden="true" ></i>
	</button>	
	<button type="button" onclick="removeFile(this)">-
	<i class="fa fa-minus" aria-hidden="true"></i>
	</button>
	</div>
</div>
 

<div id="btnDiv" style="text-align:right;">
<input type="submit" class="btn btn-primary" th:value="작성">
<a type="button" th:href="@{/board/list?pageNum=1}" class="btn btn-secondary">목록</a>
</div>
</form>
</div>
</body>
<script th:inline="javascript">
/*<![CDATA[*/
const fileList = /*[[ ${fileList} ]]*/; 
/*]]>*/
let fileIdx = fileList.length; 

function addFile(){ 
	const fileDivs = $('div[data-name="fileDiv"]');
	if (fileDivs.length > 2) {
		alert('파일은 최대 세 개까지 업로드 할 수 있습니다.');
		return false;
	}

	fileIdx++;
	
	const fileHtml = `
		<div data-name="fileDiv">
		<label for="file_${fileIdx}" class="col-sm-2 control-label">파일1</label>
			<div class="col-sm-10">
			<input type="text"  value="파일찾기" readonly/>
			<label for="file_${fileIdx}" class="control-label">찾아보기</label>
			<input type="file" name="files" id="file_${fileIdx}"  style="display:none;" onchange="changeFilename(this)"> 
			<button type="button" onclick="removeFile(this)">-
			<i class="fa fa-minus" aria-hidden="true"></i>
			</button>
			</div>
		</div>
		`;
		 
		$('#btnDiv').before(fileHtml);
}


function removeFile(elem){
	const prevTag = $(elem).prev().prop('tagName');
	if(prevTag === 'BUTTON'){
		const file=$(elem).prevAll('input[type="file"]');
		const filename = $(elem).prevAll('input[type="text"]');
		file.val('');
		filename.val('파일찾기');
		return false;
	}

	const target = $(elem).parents('div[data-name="fileDiv"]');
	target.remove();

}

function changeFilename(file){
	file = $(file);
	const filename = file[0].files[0].name;
	const target = file.prevAll('input');
	target.val(filename);
}

</script>
</html>