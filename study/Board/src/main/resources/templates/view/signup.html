<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<!-- default header name is X-CSRF-TOKEN -->
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
	<!-- ... -->

<div th:replace="/fragments/header.html :: fragment-header"></div>
<script src="//code.jquery.com/jquery.min.js"></script>
</head>
<body>
<form method="post" th:object=${user}  th:action="@{/view/signup}">
      <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"> 
	      <br/>
	      	      <br/>
	      	      	      <br/>
	      	      	      	      <br/>
	      	      	      	      	      <br/>
	<pre>
	-------------------------------------------------------
	아이디  
		  <br/>
	<input type="text" id="userid" name="userid">  
	      <span id="valid" th:text="${valid_userid}"></span> 
	-------------------------------------------------------
	닉네임 
			  <br/>
	<input type="text" id="nickname" name="nickname">   <button type="button" onclick="checkNickName()">중복확인</button>
	      	      <span id="valid" th:text="${valid_nickname}"></span>
	-------------------------------------------------------
	이름 
			  <br/>
	<input type="text" id="name" name="name">  
	      	      <span id="valid" th:text="${valid_name}"></span>
	-------------------------------------------------------
	비밀번호 
			  <br/>
	<input type="password" id="password" name="password" maxlength="32" placeholder="비밀번호는 8~16자 영문 대 소문자, 숫자, 특수문자를 사용하세요." >
	
	비밀번호 재확인 
			  <br/>
	<input type="password" id="repassword" name="repassword" maxlength="32" >
		<span id="passwordChk" ></span>
	      <span id="valid" th:text="${valid_password}"></span>
	-------------------------------------------------------
	이메일 
			  <br/>
	<input type="text" id="email" name="email">
	      <span id="valid" th:text="${valid_email}"></span>
		-------------------------------------------------------
	<button type="submit" onclick="joinform_check">회원가입</button>
	</pre>
</form>

</body>

<script th:inline="javascript">

$(function () {
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");
    $(document).ajaxSend(function(e, xhr, options) {
        xhr.setRequestHeader(header, token);
    });
});

function checkNickName(){
	var nickName = $('#name').val();
	var data = {nickname:nickName} ;
	alert(nickName);
	$.ajax({
		url:"/view/chk",
		type:"POST",
		data:data,
		success:function(data){
			if(data==0){
				alert("사용 가능한 닉네임입니다.");
			}else if(data==-1){
				alert("닉네임은 필수 입력 값입니다.")
			}
			else{
				alert("이미 존재하는 닉네임입니다.");
			}
		}		,
		error : function(request,status,error){

			alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);

			}
	});
	
}

function joinform_check(){
	var userid = document.getElementById("userid");
	var name = document.getElementById("name");
	var email = document.getElementById("email");
	var password = document.getElementById("password");
	var repassword = document.getElementById("repassword");
	
	if(userid.value == ""){
		alert("아이디를 입력하세요.");
		username.focus();
		return false;
	}
	
	if(name.value == ""){
		alert("닉네임을 입력하세요.");
		name.focus();
		return false;
	}
	
	if(email.value == ""){
		alert("이메일을 입력하세요.");
		email.focus();
		return false;
	}
	
	if(password.value == ""){
		alert("비밀번호를 입력하세요.");
		password.focus();
		return false;
	}
	
	var passwordChk = /^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*\\W)(?=\\S+$).{8,16}$/;
	
	if(!passwordChk.test(password.value)){
		alert("비밀번호는 8~16자 영문 대 소문자, 숫자, 특수문자를 사용해야합니다.")
	}
	
	
}
</script>
</html>